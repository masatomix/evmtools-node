# PR レビュー指示

## 概要

このファイルはClaude Codeのサブエージェントがコードレビューを行う際の指示です。

## 使い方

```bash
claude "PR #<番号> をレビューして。観点は prompts/review-instructions.md を参照。承認 or リジェクトも判断して、PRに記載をお願いします。"
```

---

## レビュー観点

### 1. 重大な問題（High）

必ず修正が必要な項目：

- **セキュリティ**
  - 認証・認可のバイパス可能性
  - SQLインジェクション、XSS、CSRF
  - 機密情報（トークン、パスワード）のハードコード・ログ出力
  - 不適切なCORS設定

- **データ整合性**
  - トランザクション境界の誤り
  - 競合状態（Race Condition）
  - データ消失の可能性

- **致命的バグ**
  - NullPointerException / undefined アクセスの可能性
  - 無限ループ、リソースリーク

### 2. 改善推奨（Medium）

品質向上のために対応すべき項目：

- **エラーハンドリング**
  - 例外の握りつぶし
  - 不適切なエラーメッセージ（情報漏洩、ユーザー不親切）
  - リトライ・フォールバック戦略の欠如

- **型安全性**（TypeScript）
  - `any` 型の安易な使用
  - 型ガード・型アサーションの不足
  - Optional chaining の未使用

- **パフォーマンス**
  - N+1クエリ
  - 不要な再レンダリング・再計算
  - 巨大なペイロードの非効率な処理

- **テスタビリティ**
  - 依存性注入の欠如
  - モック困難な外部依存

### 3. 提案（Low）

あれば望ましい項目：

- **可読性**
  - 命名の改善提案
  - 複雑なロジックの分割
  - マジックナンバーの定数化

- **コード規約**
  - プロジェクト規約との不整合
  - 不要なコメント、デッドコード

- **ドキュメント**
  - 公開APIのJSDoc/Javadoc不足
  - 複雑な処理への説明コメント

---

## 出力フォーマット

PRコメントは以下の形式で投稿：

```
### 🔴 High: [簡潔なタイトル]
**ファイル**: `path/to/file.ts:行番号`

[問題の説明]

**修正案**:
\`\`\`typescript
// 修正後のコード例
\`\`\`
```

重要度に応じた絵文字：
- 🔴 High
- 🟡 Medium  
- 🟢 Low

---

## レビュー完了時

全体サマリー（指摘一覧を含む）をPRコメントとして投稿：

```
## レビューサマリー

| 重要度 | 件数 |
|--------|------|
| 🔴 High | X件 |
| 🟡 Medium | Y件 |
| 🟢 Low | Z件 |

### 指摘一覧

- [ ] 🔴 `path/to/file.ts:行番号` - [指摘内容の要約]
- [ ] 🔴 `path/to/file.ts:行番号` - [指摘内容の要約]
- [ ] 🟡 `path/to/file.ts:行番号` - [指摘内容の要約]
- [ ] 🟢 `path/to/file.ts:行番号` - [指摘内容の要約]

### 総評
[全体的な印象、良かった点、主要な懸念事項]
```

また、レビュー結果に応じて、以下のコマンドを実行：

| 判定 | コマンド |
|------|----------|
| 問題なし | `gh pr review <PR番号> --approve --body "LGTM"` |
| 要修正 | `gh pr review <PR番号> --request-changes --body "サマリー"` |
| 質問のみ | `gh pr review <PR番号> --comment --body "質問内容"` |