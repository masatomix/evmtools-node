# EVM指標拡張 ブレインストーミング

作成日: 2026-01-22

## 背景

EVMに出てくる数値をプロパティとして追加したい。

### 参考資料

- [ITmedia: EVMの基礎](https://www.itmedia.co.jp/im/articles/0903/31/news118.html)

### 制約事項

- **AC (Actual Cost) は除外**: 人間が稼働した工数の記録が困難なため

---

## 現状の指標（実装済み）

| 指標 | 略称 | 計算式 | 実装状況 |
|------|------|--------|----------|
| Planned Value | PV | - | ✅ TaskRow.pv, calculatePV() |
| Earned Value | EV | - | ✅ TaskRow.ev |
| Schedule Variance | SV | EV - PV | ✅ TaskRow.calculateSV() |
| Schedule Performance Index | SPI | EV / PV | ✅ TaskRow.calculateSPI() |

---

## 標準EVM指標一覧

| 指標 | 略称 | 計算式 | ACの要否 |
|------|------|--------|----------|
| Budget at Completion | BAC | 総予定工数 | 不要 |
| Planned Value | PV | - | 不要 |
| Earned Value | EV | - | 不要 |
| Actual Cost | AC | - | **本人** |
| Scheduled Variance | SV | EV - PV | 不要 |
| Cost Variance | CV | EV - AC | 必要 |
| Schedule Performance Index | SPI | EV / PV | 不要 |
| Cost Performance Index | CPI | EV / AC | 必要 |
| Estimate To Complete | ETC | (BAC - EV) / CPI | 必要 |
| Estimate At Completion | EAC | AC + ETC | 必要 |
| Variance At Completion | VAC | BAC - EAC | 必要 |

---

## 議論: ETCのSPI版

### ETCの計算式バリエーション

参考: [ITmedia: EVMの基礎(2)](https://www.itmedia.co.jp/im/articles/0903/31/news118_2.html)

| 流派 | 計算式 | 考慮する効率 |
|------|--------|-------------|
| **CPI版** | (BAC - EV) / CPI | コストのみ |
| **CPI×SPI版** | (BAC - EV) / (CPI × SPI) | コスト＋スケジュール |
| **SPI版（本システム）** | (BAC - EV) / SPI | スケジュールのみ |

### CPI×SPI版の意味

```
ETC = (BAC - EV) / (CPI × SPI)
```

両方の効率を掛け合わせるので、より保守的（厳しめ）な見積もりになる。

**例:**
- 残作業量 = 900
- CPI = 1.05（コスト効率良い）
- SPI = 0.875（スケジュール遅れ）

```
CPI × SPI = 1.05 × 0.875 = 0.919
ETC = 900 / 0.919 ≒ 980
```

### 本システムの解釈: CPI = 1.0 と仮定

ACがないため CPI が計算できない → **CPI = 1.0（コスト効率は計画通り）と仮定**

```
ETC = (BAC - EV) / (CPI × SPI)
    = (BAC - EV) / (1.0 × SPI)   ← CPI = 1.0 と仮定
    = (BAC - EV) / SPI
```

| 解釈 | 説明 |
|------|------|
| ❌ 従来の説明 | 「ACがないからCPIが計算できない」→ 派生版を作る |
| ✅ 新しい解釈 | 「**コスト効率は計画通り（CPI=1.0）と仮定**」→ 標準式の特殊ケース |

**メリット:**
- 既存のEVM理論（CPI×SPI版）との整合性がある
- 「派生版」ではなく「標準式の特殊ケース」として説明できる
- 将来ACが取れるようになれば、式をそのまま拡張できる

### 計算式（本システム）

```
ETC = (BAC - EV) / SPI
    = (BAC - EV) / (EV / PV)
    = (BAC - EV) × (PV / EV)
```

### 具体例

| 項目 | 値 |
|------|-----|
| BAC（総予定工数） | 100人日 |
| EV（出来高） | 40人日 |
| PV（計画価値） | 50人日 |
| SPI | 0.8（遅れている） |
| **残作業量 (BAC - EV)** | 60人日 |

```
ETC' = 60 / 0.8 = 75人日
```

### 意味づけ

**「現在のスケジュール効率(0.8)が続くなら、残り60人日分の作業を終えるのに、計画上75人日分の"時間"が必要」**

| 比較 | 元のETC | SPI版 ETC' |
|------|---------|------------|
| 分母 | CPI（コスト効率） | SPI（スケジュール効率） |
| 意味 | 残作業に必要な**コスト** | 残作業に必要な**計画工数換算の時間** |

### 名称案

元のETCは「コスト」観点なので、SPI版は別の名前が適切かもしれない：

- **ESTC** (Estimate Schedule To Complete)?
- **RemainingPVs** (残り必要PV)?
- **STC** (Schedule To Complete)?
- **ETC'** (ETCダッシュ/プライム) - 派生版を示す数学的表記

**実装上の考慮:**
| 用途 | 表記 | 備考 |
|------|------|------|
| ドキュメント | ETC' | 読みやすい |
| コード（プロパティ名） | `etcPrime`? `etcSchedule`? | `'`は使えない |
| Excel出力ヘッダ | ETC' or ETC(SPI) | どちらでも可 |

---

## 議論: EAC/VACのSPI版

### 元の定義

| 指標 | 計算式 | 意味 |
|------|--------|------|
| **EAC** | AC + ETC | 完了時の総コスト予測 |
| **VAC** | BAC - EAC | 完了時のコスト差異（予算との乖離） |

### ACを除外した場合の問題

```
EAC = AC + ETC
      ↑    ↑
      ?    ETC' で代用可能
```

**AC（既に使ったコスト）の代わりに何を使う？**

#### 案1: PVで代用

| 元 | SPI版 | 意味 |
|----|-------|------|
| AC（実績コスト） | **PV**（計画価値） | 「計画上、今までに消費すべきだった工数」 |

```
EAC' = PV + ETC'
     = PV + (BAC - EV) / SPI

VAC' = BAC - EAC'
```

#### 案2: そもそも不要？

EAC/VACは「コスト」の予測・差異なので、ACがない環境では意味をなさない。
**スケジュール観点では別の指標が適切** → 「完了予測日」へ

---

## 議論: 完了予測日

### 基本アプローチ

```
計画残日数 = 計画終了日 - 基準日
実際に必要な日数 = 計画残日数 / SPI
完了予測日 = 基準日 + 実際に必要な日数
```

### 人日の考慮が必要

単純な「日数」ではなく「人日」で考える必要がある。

```
残作業量 = 60人日
↓
「60日かかる」ではなく「60人日かかる」

要員数によって実日数が変わる：
- 1人なら 60日
- 3人なら 20日
- 6人なら 10日
```

### 日ごとのPV = 要員数（稼働量）という考え方

```
日ごとのPV = その日に計画されている作業量（人日）
           ≒ その日の稼働要員数
```

| 日付 | PV | 解釈 |
|------|-----|------|
| 01/22 | 3.0 | 3人日分の作業が計画 → 実質3人稼働 |
| 01/23 | 2.5 | 2.5人日分 → 2.5人相当 |
| 01/24 | 0 | 休日 or アサインなし |

**これは理にかなっている:**
- 1人フル稼働 → PV = 1人日
- 3人フル稼働 → PV = 3人日
- 2人が半日 → PV = 1人日

### 完了予測日の計算ロジック

```
残作業量 = BAC - EV

将来の各日について:
  計画消化ペース = その日のPV
  実際の消化ペース = PV × SPI  ← 効率を考慮

  残作業量から実際の消化ペースを引いていく
  残作業量 ≤ 0 になった日 = 完了予測日
```

**例:**
| 日付 | PV | 実際消化(×SPI=0.8) | 残作業量 |
|------|-----|-------------------|---------|
| 開始時 | - | - | 60人日 |
| 01/23 | 3.0 | 2.4 | 57.6 |
| 01/24 | 3.0 | 2.4 | 55.2 |
| ... | ... | ... | ... |

---

## 議論: 計画終了日以降のPVをどうするか

### 問題

```
計画終了日: 2/28
SPI: 0.8 → 計画より遅れている → 2/28を超える可能性

2/28以降のPVデータは存在しない
→ 消化ペースをどう仮定する？
```

### 選択肢

| 案 | 計算方法 | メリット | デメリット |
|----|----------|----------|------------|
| **A: 期間平均** | BAC / 計画稼働日数 | シンプル | 要員変動を無視 |
| **B: 直近N日平均** | 直近2週間のPV平均 | 現状の体制を反映 | N日の定義が曖昧 |
| **C: 終盤の平均** | 計画終了日付近のPV平均 | 終盤体制を反映 | 終盤が特殊な場合ズレる |

**例（期間平均の場合）:**
```
BAC = 100人日
計画期間 = 50稼働日
期間平均PV = 100 / 50 = 2.0人日/日

計画終了日以降は「2.0人日/日」で消化すると仮定
```

---

## 議論: 生産性のライフサイクル

### プロジェクトにおける生産性の推移

```
生産性
  ^
  │      ┌───────┐
  │     /         \
  │    /           \
  │   /             \
  │  /               \
  └─┴─────────────────┴──→ 時間
    序盤   中盤    終盤
    (低)   (高)    (低)
```

| フェーズ | 生産性 | 理由 |
|----------|--------|------|
| 序盤 | 低い | 学習コスト、環境構築、仕様理解 |
| 中盤 | 高い | チーム習熟、効率的な作業 |
| 終盤 | 低い | 難易度高いタスク残留、バグ修正、調整 |

### 問題の複雑さ

完了予測に影響する変数が2つある:

| 変数 | 計画終了後の仮定 |
|------|-----------------|
| **PV（要員数）** | どの期間の平均を使う？ |
| **SPI（生産性）** | 現在のSPI？終盤想定で下げる？ |

### 現実的なアプローチ案

| アプローチ | PV | SPI | 特徴 |
|------------|-----|-----|------|
| **楽観的** | 期間平均 | 現在のSPI | 今のペースが続く想定 |
| **現実的** | 直近N日平均 | 直近N日のSPI | 現状ベース |
| **保守的** | 直近N日平均 | SPI × 0.8〜0.9 | 終盤の効率低下を織り込む |

### 方針案

**まずはシンプルに「直近N日の実績ベース」で実装**
→ 将来的にパラメータ調整できるようにする

または、**最初から複数パターン（楽観/現実/保守）を出す設計** にする

---

## 議論: 日あたりPVの算出問題

### 問題のシナリオ

「5人いるのにPV 1.1人日が数日続く」（タスク待ち状態）

```
実際の要員数: 5人
直近N日のPV: 1.1人日/日（タスク待ち状態）
残作業量: 60人日
SPI: 0.8
```

#### 直近PV平均を使った場合（誤った予測）

```
実際の消化ペース = 1.1 × 0.8 = 0.88人日/日
完了まで = 60 / 0.88 ≒ 68日  ← 大幅に悲観的
```

#### 本来の能力（5人稼働）の場合

```
実際の消化ペース = 5.0 × 0.8 = 4.0人日/日
完了まで = 60 / 4.0 = 15日
```

### 問題の本質

| 概念 | 意味 | 今回のケース |
|------|------|-------------|
| **日ごとのPV** | その日に**計画された**作業量 | 1.1人日 |
| **要員数** | **潜在的な**消化能力 | 5人 |

**「PV = 要員数」の仮定が崩れる**
→ タスク待ち・依存関係・仕様待ちなどで、要員がいても作業がない状況

### 採用方針

```
日あたりPV（消化能力）の決定方法:

1. デフォルト: 直近N日のPV平均を自動計算
2. オプション: 手入力でオーバーライド可能
```

| 設定項目 | 値 | 備考 |
|----------|-----|------|
| **N（直近日数）** | 設定可能、デフォルト7日 | 1週間 |
| **手入力項目名** | 日あたりPV | 人日/日 単位 |
| **優先度** | 手入力 > 自動計算 | 手入力があればそちらを採用 |

#### 使用イメージ

| ケース | 自動計算値 | 手入力 | 採用値 |
|--------|-----------|--------|--------|
| 通常 | 3.0人日/日 | - | 3.0（自動） |
| タスク待ち | 1.1人日/日 | 5.0 | 5.0（手入力） |

---

## TODO

- [ ] ETC'の名称・プロパティ名の決定
- [ ] 完了予測日の計算ロジック詳細化
- [ ] 計画終了日以降のPV仮定方法の決定
- [ ] 生産性変動の考慮方法の決定（シンプル or 複数パターン）
- [ ] 追加する指標の最終決定
- [ ] 適用レベルの決定（タスク単位 / プロジェクト単位 / 担当者単位）
- [ ] 要件定義書の作成
- [ ] Issue起票

---

## 関連ドキュメント

- [GLOSSARY.md](GLOSSARY.md) - コア用語集
- [TaskRow.spec.md](specs/domain/master/TaskRow.spec.md) - TaskRow仕様
- [Project.spec.md](specs/domain/master/Project.spec.md) - Project仕様
