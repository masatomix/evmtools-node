# CLI コマンド

コマンドラインインターフェースの使い方を説明します。

## 利用可能なコマンド

| コマンド | 説明 |
|----------|------|
| `pbevm-show-project` | プロジェクト情報を表示 |
| `pbevm-diff` | 2時点間の差分を表示 |
| `pbevm-show-pv` | PVデータを表示 |
| `pbevm-tree` | ツリー構造を表示 |
| `pbevm-show-resourceplan` | 要員計画を表示（ベータ版） |

---

## pbevm-show-project

プロジェクト情報を一覧表示します。

### 使用方法

```bash
# npm scripts経由（開発時）
npm run pbevm-show-project

# 直接実行
npx pbevm-show-project --path ./now.xlsm
```

### オプション

| オプション | 説明 | デフォルト |
|-----------|------|----------|
| `--path` | Excelファイルのパス | `./now.xlsm` |

### 出力内容

1. **タスク一覧**: 全タスクの詳細情報
2. **プロジェクト統計**: BAC, PV, EV, SPI, 完了予測
3. **担当者別統計**: 担当者ごとの集計

### 出力例（タスク一覧）

```
┌─────────┬───────┬────┬───────┬──────────────┬───────────┬──────────┬──────────────┬─────┬─────┬─────┬───────────┐
│ (index) │ sharp │ id │ level │     name     │ assignee  │ workload │ progressRate │ pv  │ ev  │ spi │ delayDays │
├─────────┼───────┼────┼───────┼──────────────┼───────────┼──────────┼──────────────┼─────┼─────┼─────┼───────────┤
│    0    │   1   │ 1  │   1   │  '要件定義'  │ undefined │    4     │      1       │  4  │  4  │  1  │ undefined │
│    1    │   2   │ 2  │   2   │  '機能全体'  │  '要員A'  │    4     │      1       │  4  │  4  │  1  │ undefined │
│   ...   │  ...  │...│  ...  │     ...      │    ...    │   ...    │     ...      │ ... │ ... │ ... │    ...    │
└─────────┴───────┴────┴───────┴──────────────┴───────────┴──────────┴──────────────┴─────┴─────┴─────┴───────────┘
```

### 出力例（プロジェクト統計）

```
┌─────────┬─────────────┬──────────────┬──────────────┬─────────────────┬────────────────────┬──────────────┬───────────────────┬─────────┬────────────────────┐
│ (index) │ projectName │  startDate   │   endDate    │ totalTasksCount │ totalWorkloadExcel │   baseDate   │ totalPvCalculated │ totalEv │        spi         │
├─────────┼─────────────┼──────────────┼──────────────┼─────────────────┼────────────────────┼──────────────┼───────────────────┼─────────┼────────────────────┤
│    0    │    'now'    │ '2025/07/01' │ '2025/08/26' │       14        │         66         │ '2025/07/25' │        34         │  26.5   │ 0.7794117647058824 │
└─────────┴─────────────┴──────────────┴──────────────┴─────────────────┴────────────────────┴──────────────┴───────────────────┴─────────┴────────────────────┘
```

### 出力例（担当者別統計）

```
┌─────────┬──────────┬─────────────────┬────────────────────┬───────────────────┬─────────┬────────────────────┐
│ (index) │ assignee │ totalTasksCount │ totalWorkloadExcel │ totalPvCalculated │ totalEv │        spi         │
├─────────┼──────────┼─────────────────┼────────────────────┼───────────────────┼─────────┼────────────────────┤
│    0    │ '要員A'  │        8        │         39         │        19         │   15    │ 0.7894736842105263 │
│    1    │ '要員B'  │        3        │         15         │        10         │   7.5   │        0.75        │
│    2    │ '要員C'  │        3        │         12         │         5         │    4    │        0.8         │
└─────────┴──────────┴─────────────────┴────────────────────┴───────────────────┴─────────┴────────────────────┘
```

---

## pbevm-diff

2時点間のプロジェクトスナップショットを比較し、差分を表示します。

### 使用方法

```bash
# npm scripts経由（開発時）
npm run pbevm-diff

# 直接実行
npx pbevm-diff --path ./now.xlsm --prevPath ./prev.xlsm
```

### オプション

| オプション | 説明 | デフォルト |
|-----------|------|----------|
| `--path` | 現在のExcelファイルパス | `./now.xlsm` |
| `--prevPath` | 比較元のExcelファイルパス | `./prev.xlsm` |

### 出力内容

1. **プロジェクトDiff**: プロジェクト全体の差分サマリー
2. **担当者Diff**: 担当者別の差分
3. **タスクDiff**: タスク単位の差分詳細

### 出力例（プロジェクトDiff）

```
┌─────────┬─────────┬─────────┬────────┬────────┬───────────┬───────────┬───────────────┬────────────┬──────────────┐
│ (index) │ deltaPV │ deltaEV │ prevPV │ prevEV │ currentPV │ currentEV │ modifiedCount │ addedCount │ removedCount │
├─────────┼─────────┼─────────┼────────┼────────┼───────────┼───────────┼───────────────┼────────────┼──────────────┤
│    0    │   30    │  19.6   │   0    │  2.9   │    30     │   22.5    │       8       │     0      │      0       │
└─────────┴─────────┴─────────┴────────┴────────┴───────────┴───────────┴───────────────┴────────────┴──────────────┘
```

### 出力例（担当者Diff）

```
┌─────────┬──────────┬─────────┬─────────┬───────────────┬────────────┬──────────────┐
│ (index) │ assignee │ deltaPV │ deltaEV │ modifiedCount │ addedCount │ removedCount │
├─────────┼──────────┼─────────┼─────────┼───────────────┼────────────┼──────────────┤
│    0    │ '要員A'  │   15    │  10.6   │       4       │     0      │      0       │
│    1    │ '要員B'  │   10    │    5    │       3       │     0      │      0       │
│    2    │ '要員C'  │    5    │    4    │       1       │     0      │      0       │
└─────────┴──────────┴─────────┴─────────┴───────────────┴────────────┴──────────────┘
```

### 出力例（タスクDiff）

```
┌─────────┬────┬─────────┬──────────────┬───────────────────┬─────────┬─────────┬────────────┐
│ (index) │ id │  name   │   fullName   │ deltaProgressRate │ deltaPV │ deltaEV │  diffType  │
├─────────┼────┼─────────┼──────────────┼───────────────────┼─────────┼─────────┼────────────┤
│    0    │ 4  │ '機能1' │ '設計/機能1' │         1         │    3    │    3    │ 'modified' │
│    1    │ 5  │ '機能2' │ '設計/機能2' │        0.8        │    2    │   1.6   │ 'modified' │
│    2    │ 6  │ '機能3' │ '設計/機能3' │        0.5        │    5    │   2.5   │ 'modified' │
│   ...   │...│   ...   │     ...      │        ...        │   ...   │   ...   │    ...     │
└─────────┴────┴─────────┴──────────────┴───────────────────┴─────────┴─────────┴────────────┘
```

---

## pbevm-show-pv

プロジェクトのPV（Planned Value）データを時系列で表示します。

### 使用方法

```bash
# npm scripts経由（開発時）
npm run pbevm-show-pv

# 直接実行
npx pbevm-show-pv --path ./now.xlsm
```

### オプション

| オプション | 説明 | デフォルト |
|-----------|------|----------|
| `--path` | Excelファイルのパス | `./now.xlsm` |

---

## pbevm-tree

プロジェクトのツリー構造を表示します。

### 使用方法

```bash
# npm scripts経由（開発時）
npm run pbevm-tree

# 直接実行
npx pbevm-tree --path ./now.xlsm
```

### オプション

| オプション | 説明 | デフォルト |
|-----------|------|----------|
| `--path` | Excelファイルのパス | `./now.xlsm` |
| `--depth` | 出力する階層の深さ（1=直下のみ） | 全階層 |
| `--json` | JSON形式で出力 | `false` |

### 出力例（テキスト形式）

```
$ npx pbevm-tree --path ./now.xlsm
要件定義
└── 機能全体

設計
├── 機能1
├── 機能2
├── 機能3
└── 機能4

開発
├── 機能1
├── 機能2
├── 機能3
└── 機能4

テスト
├── 単体テスト
├── 連結テスト
└── 総合テスト

リリース
├── 準備
└── 作業
```

### 出力例（深さ指定）

```
$ npx pbevm-tree --path ./now.xlsm --depth 0
要件定義

設計

開発

テスト

リリース
```

### 出力例（JSON形式）

```bash
$ npx pbevm-tree --path ./now.xlsm --json
[
  {
    "name": "要件定義",
    "children": [
      { "name": "機能全体", "children": [] }
    ]
  },
  {
    "name": "設計",
    "children": [
      { "name": "機能1", "children": [] },
      { "name": "機能2", "children": [] },
      ...
    ]
  },
  ...
]
```

> **ヒント**: `--json` オプションは他のツールとの連携に便利です。

---

## pbevm-show-resourceplan

要員計画を表示します（ベータ版機能）。

### 使用方法

```bash
# npm scripts経由（開発時）
npm run pbevm-show-resourceplan

# 直接実行
npx pbevm-show-resourceplan
```

> **Note**: この機能はベータ版のため、API が変更される可能性があります。

---

## 開発時の実行

`ts-node` を使用して、ビルドせずに直接実行することもできます。

```bash
# pbevm-show-project
npx ts-node ./src/presentation/cli-pbevm-show-project --path now.xlsm

# pbevm-diff
npx ts-node ./src/presentation/cli-pbevm-diff --path now.xlsm --prevPath prev.xlsm

# pbevm-show-pv
npx ts-node ./src/presentation/cli-pbevm-show-pv --path now.xlsm
```

---

## npm scripts

package.json に定義されている便利なスクリプト:

```bash
npm run pbevm-show-project       # now.xlsm のプロジェクト情報を表示
npm run pbevm-diff               # now.xlsm と prev.xlsm の差分を表示
npm run pbevm-show-pv            # now.xlsm の PV データを表示
npm run pbevm-tree               # now.xlsm のツリー構造を表示
npm run pbevm-show-resourceplan  # 要員計画を表示（ベータ版）
```

---

## ヘルプの表示

各コマンドに `--help` オプションを付けると、使用方法を確認できます。

```bash
npx pbevm-show-project --help
npx pbevm-diff --help
```

---

## 次のステップ

- [基本的な使い方](./01-basic-usage.md) - ライブラリとして使用
- [プロジェクト統計](./02-project-statistics.md) - 詳細な統計情報
- [スナップショット比較](./05-diff-snapshots.md) - プログラムでの差分分析
