# VersionInfo 仕様書

**バージョン**: 1.0.0
**作成日**: 2025-12-16
**ソースファイル**: `src/common/VersionInfo.ts`

---

## 1. 基本情報

### 1.1 概要

| 項目 | 内容 |
|------|------|
| **クラス名** | `VersionInfo`（モジュール） |
| **分類** | **ユーティリティ（Utility）** |
| **実装インターフェース** | - |
| **パッケージ** | `src/common/VersionInfo.ts` |
| **責務** | package.jsonからバージョン情報を取得するユーティリティ |

### 1.2 ユビキタス言語（ドメイン用語）

| ドメイン用語 | 実装名 | 定義 |
|-------------|--------|------|
| バージョン情報 | `VersionInfo` | パッケージの名前・バージョン・説明を含む情報 |

### 1.3 境界づけられたコンテキスト（所属ドメイン）

```
┌─────────────────────────────────────────────────────────────┐
│                      common 層                               │
│  ┌─────────────────────────────────────────────────────┐    │
│  │                   VersionInfo                        │    │
│  │  - getVersionInfo(): VersionInfo                    │    │
│  └─────────────────────────────────────────────────────┘    │
│                          │                                   │
│                          ▼                                   │
│                    package.json                              │
└─────────────────────────────────────────────────────────────┘
```

---

## 2. 不変条件（Invariants）

| ID | 不変条件 | 検証タイミング |
|----|----------|----------------|
| INV-VI-01 | `getVersionInfo()`は常にVersionInfoオブジェクトを返す | 全呼び出し |
| INV-VI-02 | 2回目以降の呼び出しはキャッシュされた値を返す | 全呼び出し |

---

## 3. プロパティ仕様

### 3.1 VersionInfo型

| プロパティ | 型 | 必須 | 制約 | デフォルト | 説明 |
|-----------|-----|:----:|------|-----------|------|
| `version` | `string` | ○ | - | - | パッケージのバージョン番号 |
| `name` | `string` | ○ | - | - | パッケージ名 |
| `description` | `string` | ○ | - | - | パッケージの説明文 |

### 3.2 公開プロパティ（getter）

該当なし

### 3.3 内部キャッシュ

| プロパティ | 型 | 説明 |
|-----------|-----|------|
| `cachedInfo` | `VersionInfo \| undefined` | getVersionInfo()の結果キャッシュ |

---

## 4. コンストラクタ仕様

該当なし（モジュールのため）

---

## 5. メソッド仕様

### 5.1 `getVersionInfo(): VersionInfo`

#### 目的
バージョン情報を取得する

#### シグネチャ
```typescript
function getVersionInfo(): VersionInfo
```

#### 事前条件

該当なし

#### 事後条件

| ID | 条件 |
|----|------|
| POST-GVI-01 | VersionInfoオブジェクトを返す |
| POST-GVI-02 | versionはpackage.jsonのversionと一致 |
| POST-GVI-03 | nameはpackage.jsonのnameと一致 |
| POST-GVI-04 | descriptionはpackage.jsonのdescriptionと一致 |

#### アルゴリズム

```
1. キャッシュが存在する場合、キャッシュを返す
2. package.jsonを読み込む
3. version, name, description を抽出
4. キャッシュに保存
5. VersionInfo オブジェクトを返す
```

#### 例外処理

| 条件 | エラー内容 |
|------|-----------|
| package.jsonが存在しない | Error をスロー |
| JSONパースエラー | Error をスロー |

#### 同値クラス・境界値

| ID | 分類 | 入力条件 | 期待結果 |
|----|------|----------|----------|
| EQ-GVI-001 | 正常系 | 有効なpackage.json | VersionInfoが返される |
| EQ-GVI-002 | 正常系 | 2回呼び出し | 同一オブジェクト（キャッシュ） |
| EQ-GVI-003 | 境界値 | versionフィールドがない | 空文字を返す |
| EQ-GVI-004 | 境界値 | nameフィールドがない | 空文字を返す |
| EQ-GVI-005 | 境界値 | descriptionフィールドがない | 空文字を返す |

---

## 6. テストシナリオ（Given-When-Then形式）

### 6.1 正常系

```gherkin
Scenario: バージョン情報を取得する
  Given 有効なpackage.json
  When  getVersionInfo()を呼び出す
  Then  VersionInfoオブジェクトが返される
  And   versionがpackage.jsonと一致する
  And   nameがpackage.jsonと一致する
  And   descriptionがpackage.jsonと一致する

Scenario: キャッシュが効く
  Given getVersionInfo()を1回呼び出し済み
  When  getVersionInfo()を再度呼び出す
  Then  同一オブジェクトが返される
```

---

## 7. 外部依存

| 名前 | 種別 | 説明 |
|------|------|------|
| `package.json` | ファイル | バージョン情報の取得元 |

---

## 8. 関連オブジェクト

### 8.1 依存関係図

```
┌─────────────────────────────────────────────────────────────┐
│                      VersionInfo                            │
│  (ユーティリティ)                                           │
├─────────────────────────────────────────────────────────────┤
│                          │                                  │
│                          ▼                                  │
│                    package.json                             │
└─────────────────────────────────────────────────────────────┘
```

### 8.2 関係一覧

| 関係先 | 関係タイプ | 説明 |
|--------|-----------|------|
| `package.json` | reads | バージョン情報を読み込む |

---

## 9. テストケース数サマリ

| カテゴリ | 計画 | 実装 |
|----------|------|------|
| getVersionInfo | 5件 | 5件 |
| **合計** | **5件** | **5件** |

---

## 10. 要件トレーサビリティ

> **重要**: このセクションは必須です。grepで検索可能な形式で記載すること。

| 要件ID | 受け入れ基準 | 対応テストケース | 結果 |
|--------|-------------|-----------------|------|
| REQ-VERSION-001 AC-01 | バージョン情報を取得できる | EQ-GVI-001 | ✅ PASS |

> **ステータス凡例**:
> - ⏳: 未実装
> - ✅ PASS: テスト合格
> - ❌ FAIL: テスト失敗

---

## 11. テスト実装

### 11.1 テストファイル

| ファイル | 説明 | テスト数 |
|---------|------|---------|
| `src/common/__tests__/VersionInfo.test.ts` | 単体テスト | 5件 |

### 11.2 テストフィクスチャ

該当なし

### 11.3 テスト実行結果

```
実行日: 2025-12-16
Test Suites: 1 passed, 1 total
Tests:       5 passed, 5 total
```

---

## 12. 設計上の課題・改善提案

該当なし

---

## 13. 変更履歴

| バージョン | 日付 | 変更内容 | 要件ID |
|-----------|------|---------|--------|
| 1.0.0 | 2025-12-16 | 初版作成 | REQ-VERSION-001 |
